<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exam Routine Management</title>
  <link href="https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/css/nepali.datepicker.v5.0.6.min.css" rel="stylesheet" type="text/css"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#e5e7eb 0%,#f3f4f6 100%);min-height:100vh;padding:30px 20px}
    
    .container{max-width:1200px;margin:0 auto}
    
    .header{background:#fff;border-radius:12px;padding:30px;margin-bottom:30px;box-shadow:0 2px 8px rgba(0,0,0,.1);position:relative;overflow:hidden}
    .header::before{content:'';position:absolute;top:0;left:0;width:100%;height:4px;background:linear-gradient(90deg,#ff8c42 0%,#e67a2e 100%)}
    .page-title{font-size:32px;font-weight:800;color:#1a3a52;margin-bottom:8px;letter-spacing:.5px}
    .page-subtitle{font-size:15px;color:#64748b;font-weight:400}
    
    .form-container{background:#fff;border-radius:12px;padding:30px;margin-bottom:30px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
    .form-title{font-size:18px;font-weight:700;color:#1a3a52;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid #ff8c42}
    
    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:24px}
    .form-group{display:flex;flex-direction:column;gap:8px}
    .form-label{font-size:13px;font-weight:700;color:#1a3a52;text-transform:uppercase;letter-spacing:.5px}
    
    select,input[type="text"]{width:100%;padding:12px 16px;border:2px solid #e1e8ed;border-radius:8px;font-size:14px;color:#1a3a52;background:#fff;transition:all .2s;font-weight:600}
    select{background:#fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff8c42' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E") no-repeat right 12px center/18px;padding-right:40px;appearance:none;cursor:pointer}
    select:hover,input[type="text"]:hover{border-color:#ff8c42;background-color:#fff9f5}
    select:focus,input[type="text"]:focus{outline:0;border-color:#ff8c42;box-shadow:0 0 0 3px rgba(255,140,66,.1);background-color:#fff}
    
    input[type="submit"]{padding:14px 32px;background:linear-gradient(135deg,#ff8c42 0%,#e67a2e 100%);color:#fff;border:0;border-radius:8px;font-size:15px;font-weight:700;cursor:pointer;transition:all .2s;box-shadow:0 4px 12px rgba(255,140,66,.3);text-transform:uppercase;letter-spacing:.8px}
    input[type="submit"]:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(255,140,66,.4)}
    input[type="submit"]:active{transform:translateY(0)}
    
    .action-buttons{display:flex;gap:8px}
    .action-buttons button{padding:8px 16px;border:0;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}
    .btn-edit{background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);color:#fff;box-shadow:0 2px 8px rgba(59,130,246,.3)}
    .btn-edit:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(59,130,246,.4)}
    .btn-delete{background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);color:#fff;box-shadow:0 2px 8px rgba(239,68,68,.3)}
    .btn-delete:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(239,68,68,.4)}
    .action-buttons button:active{transform:translateY(0)}
    
    .table-container{background:#fff;border-radius:12px;padding:30px;box-shadow:0 2px 8px rgba(0,0,0,.1);overflow-x:auto}
    .table-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid #ff8c42}
    .table-title{font-size:18px;font-weight:700;color:#1a3a52}
    .table-badge{background:linear-gradient(135deg,#ff8c42 0%,#e67a2e 100%);color:#fff;padding:6px 14px;border-radius:20px;font-size:12px;font-weight:700;letter-spacing:.5px}
    
    table{width:100%;border-collapse:collapse;border-spacing:0}
    thead tr{background:linear-gradient(135deg,#1a3a52 0%,#2c5f8d 100%)}
    th{padding:16px 20px;text-align:left;font-size:13px;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.8px;border:none}
    tbody tr{border-bottom:1px solid #e1e8ed;transition:background .2s}
    tbody tr:hover{background:#f8f9fa}
    tbody tr:last-child{border-bottom:none}
    td{padding:16px 20px;font-size:14px;color:#1a3a52;font-weight:600}
    
    .empty-state{text-align:center;padding:60px 20px;color:#94a3b8}
    .empty-state svg{width:80px;height:80px;margin-bottom:20px;opacity:.3}
    .empty-state-text{font-size:16px;font-weight:600}
    
    @media(max-width:768px){
      .page-title{font-size:24px}
      .form-grid{grid-template-columns:1fr}
      .table-container{padding:20px}
      th,td{padding:12px;font-size:12px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 class="page-title">Exam Routine Management</h1>
      <p class="page-subtitle">Create and manage examination schedules for <%= terminal %> - <%= academicYear %></p>
    </div>
    <form action="<%= editing ? `/saveexamroutine?routineId=${routineData._id}&editing=true&studentClass=${studentClass}&terminal=${terminal}&academicYear=${academicYear}` : `/saveexamroutine?studentClass=${studentClass}&terminal=${terminal}&academicYear=${academicYear}` %>" method="POST">
    <div class="form-container">
      <h2 class="form-title">Add New Exam Schedule</h2>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="studentClass">Class</label>
            <select name="studentClass" id="studentClass" required>
              <option value="" selected disabled>Select Class</option>
              <% uniqueClasses = new Set(studentClassdata.map(cls => cls.studentClass)); %>
              <% uniqueClasses.forEach((cls)=> { %>
                <option value="<%= cls %>"><%= cls %></option>
              <%}); %>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="nepali-datepicker">Exam Date</label>
            <input type="text" id="nepali-datepicker" name="nepalidate" placeholder="Select Nepali Date" required/>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="subject">Subject</label>
            <select name="subject" id="subject" required>
              <option value="" selected disabled>Select Subject</option>
              <% uniqueSubjects = new Set(subjectData.map(subj => subj.newsubject)); %>
              <% uniqueSubjects.forEach((subj)=> { %>
                <option value="<%= subj %>"><%= subj %></option>
              <% }); %>
            </select>
          </div>
        </div>
        
        <input type="hidden" name="terminal" value="<%= terminal %>">
        <input type="hidden" name="academicYear" value="<%= academicYear %>">
        <input type="submit" value="<%= editing ? 'Update Exam Routine' : 'Add Rotuine' %>">
      </form>
    </div>
    
    <div class="table-container">
      <div class="table-header">
        <h2 class="table-title">Current Exam Schedule</h2>
        <span class="table-badge"><%= examRoutines.length %> Exams</span>
      </div>
      
      <% if(examRoutines && examRoutines.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>Class</th>
              <th>Date (Nepali)</th>
              <th>Subject</th>
              <th colspan="2">Action</th>
            </tr>
          </thead>
          <tbody>
            <% examRoutines.forEach((routine) => { %>
              <tr>
                <td><%=routine.studentClass %></td>
                <td><%= routine.nepalidate %></td>
                <td><%= routine.subject %></td>
                <td>
                  <div class="action-buttons">
                    <a href="/editroutine?routineId=<%= routine._id%>&editing=true&terminal=<%= terminal %>&academicYear=<%= academicYear %>&subject=<%= routine.subject %>">
                      <button class="btn-edit">Edit</button>
                    </a>
                    <a href="/deleteroutine?routineId=<%= routine._id%>&terminal=<%= terminal %>&academicYear=<%= academicYear %>">
                      <button class="btn-delete" onclick="return confirm('Are you sure, you want to delete <%=routine.subject%> of <%=routine.studentClass%>?')">Delete</button>
                    </a>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <div class="empty-state">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <div class="empty-state-text">No exam schedules created yet. Add your first exam above.</div>
        </div>
      <% } %>
    </div>
  </div>

  <script src="https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/js/nepali.datepicker.v5.0.6.min.js" type="text/javascript"></script>
  <script type="text/javascript">
    window.onload = function() {
      var mainInput = document.getElementById("nepali-datepicker");
      mainInput.NepaliDatePicker();
    };
  </script>
  <% if(editing) { %>
<script>
  document.getElementById('subject').value = "<%= routineData.subject %>";
  document.getElementById('studentClass').value = "<%= routineData.studentClass %>";
  document.getElementById('nepali-datepicker').value = "<%= routineData.nepalidate %>";
</script>
  <% } %>
</body>
</html> 